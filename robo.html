<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireRobo Control | Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS VARIABLES & RESET (Clean, Professional Theme) --- */
        :root {
            --primary: #2980B9; /* Stronger Professional Blue */
            --secondary: #2C3E50; /* Dark Navy for text */
            --accent: #E74C3C; /* Stronger Alert Red */
            --success: #2ECC71; /* Clear Green */
            --bg-start: #F8F9FA;
            --bg-end: #EAEFF4;
            --bg-gradient: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%);
            --glass: rgba(255, 255, 255, 0.98);
            --shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Nunito', sans-serif; }

        body {
            background: var(--bg-gradient);
            min-height: 100vh;
            color: var(--secondary);
            overflow-x: hidden;
        }

        /* --- NAVIGATION --- */
        nav {
            background: white;
            padding: 1rem 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid #EAEFF4; 
        }

        /* Name: FireRobo Control */
        .logo { 
            font-size: 1.8rem; 
            font-weight: 700; 
            color: var(--accent); /* Using red for "Fire" part of the name */
            font-family: 'Poppins', sans-serif; 
            letter-spacing: 0.5px;
        }
        .logo span { color: var(--secondary); }
        
        .nav-links button {
            background: none;
            border: none;
            margin-left: 15px;
            font-size: 1rem;
            cursor: pointer;
            transition: 0.3s;
            color: #7F8C8D;
            padding: 5px 10px;
        }
        .nav-links button:hover { color: var(--primary); }
        .btn-primary {
            background: var(--primary);
            color: white !important;
            padding: 8px 20px;
            border-radius: 25px; 
            font-weight: 600;
            box-shadow: 0 4px 10px rgba(41, 128, 185, 0.3);
            transition: background 0.3s;
        }
        .btn-primary:hover { background: #2471A3; }

        /* --- PAGE SECTIONS --- */
        .page { display: none; padding: 3rem 5%; animation: fadeIn 0.5s ease-in-out; }
        .active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- LANDING PAGE --- */
        #landing { text-align: center; padding-top: 15vh; }
        .hero-title { font-size: 3.5rem; margin-bottom: 1rem; font-weight: 700; color: var(--secondary); }
        .hero-subtitle { font-size: 1.4rem; color: #7F8C8D; margin-bottom: 3rem; }
        
        /* --- AUTH FORMS --- */
        .auth-container {
            max-width: 420px;
            margin: 7vh auto;
            background: var(--glass);
            padding: 2.5rem;
            border-radius: 12px; 
            box-shadow: var(--shadow);
            text-align: center;
        }
        .form-group { margin-bottom: 1.5rem; text-align: left; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 1rem; font-weight: 600; }
        .form-group input {
            width: 100%; padding: 12px; border: 1px solid #DCE1E8; border-radius: 8px; 
            transition: border-color 0.3s;
        }
        .auth-btn { 
            width: 100%; 
            background: var(--secondary); 
            color: white; 
            padding: 12px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: 700;
        }
        .switch-auth { margin-top: 1.5rem; font-size: 1rem; color: var(--primary); cursor: pointer; font-weight: 600; }

        /* --- DASHBOARD --- */
        .dashboard-header { margin-bottom: 2.5rem; } 
        .dashboard-header h2 { font-weight: 700; font-size: 1.8rem; }
        
        /* Grid for Sensors */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 30px; 
            margin-bottom: 3rem;
        }

        .card {
            background: white;
            padding: 2.2rem; 
            border-radius: 12px; 
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            border: 2px solid transparent; 
            transition: all 0.3s;
        }
        .card:hover { border-color: #DCE1E8; }
        .card i { font-size: 2.8rem; margin-bottom: 10px; color: #95A5A6; }
        .card h3 { font-size: 1.1rem; color: #7F8C8D; margin-bottom: 10px; font-weight: 400; }
        .card .value { font-size: 2.6rem; font-weight: 700; color: var(--secondary); }
        
        /* Specific Card Colors and Borders */
        .card-fire.active-fire { border-color: var(--accent); box-shadow: 0 0 15px rgba(231, 76, 60, 0.4); } 
        .card-fire.active-fire i { color: var(--accent); }
        .card-pump { border-color: var(--primary); } 
        .card-pump i { color: var(--primary); }
        
        /* Table */
        .data-table-container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }
        .data-table-container h3 { font-weight: 600; margin-bottom: 15px; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ECF0F1; font-size: 0.95rem; }
        th { background: #F8F9F9; color: var(--secondary); font-weight: 700; text-transform: uppercase; }
        tr:last-child td { border-bottom: none; }

    </style>
</head>
<body>

    <nav>
        <div class="logo">Fire<span style="color: var(--secondary);">Robo</span></div>
        <div class="nav-links" id="nav-public">
            <button onclick="showPage('landing')">Home</button>
            <button onclick="showPage('login')" class="btn-primary">Login</button>
        </div>
        <div class="nav-links" id="nav-private" style="display: none;">
            <button onclick="showPage('landing')">Home</button>
            <button onclick="showPage('dashboard')">Dashboard</button>
            <button onclick="logout()" class="btn-primary">Logout <i class="fa-solid fa-right-from-bracket"></i></button>
        </div>
    </nav>

    <section id="landing" class="page active">
        <h1 class="hero-title">Autonomous Fire Chaser <br> & Extinguisher System</h1>
        <p class="hero-subtitle">Real-time monitoring and control for smart fire detection and suppression.</p>
        <div style="font-size: 5rem; color: var(--primary); margin: 30px;">
            <i class="fa-solid fa-fire-extinguisher"></i>
        </div>
        <button onclick="showPage('signup')" class="btn-primary" style="font-size: 1.2rem; padding: 15px 40px;">Get Started</button>
    </section>

    <section id="login" class="page">
        <div class="auth-container">
            <h2>Welcome Back</h2>
            <p style="color: grey; margin-bottom: 30px;">Login to access the dashboard</p>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" placeholder="admin@firerobo.com" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" placeholder="Any password works" required>
                </div>
                <button type="submit" class="auth-btn">Login</button>
            </form>
            <div class="switch-auth" onclick="showPage('signup')">New here? Create an account</div>
        </div>
    </section>

    <section id="signup" class="page">
        <div class="auth-container">
            <h2>Create Account</h2>
            <p style="color: grey; margin-bottom: 30px;">Join the safety network</p>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" required>
                </div>
                <button type="submit" class="auth-btn">Sign Up</button>
            </form>
            <div class="switch-auth" onclick="showPage('login')">Already have an account? Login</div>
        </div>
    </section>

    <section id="dashboard" class="page">
        <div class="dashboard-header">
            <h2><i class="fa-solid fa-gauge-high"></i> FireRobo Control Panel</h2>
        </div>

        <div class="dashboard-grid">
            <div class="card card-fire" id="card-fire-status">
                <i class="fa-solid fa-fire"></i>
                <h3>Fire Status</h3>
                <div class="value" id="disp-status">Safe</div>
            </div>

            <div class="card">
                <i class="fa-solid fa-temperature-full"></i>
                <h3>Intensity</h3>
                <div class="value" id="disp-intensity">0</div>
            </div>

            <div class="card">
                <i class="fa-solid fa-compass"></i>
                <h3>Direction</h3>
                <div class="value" id="disp-direction">--</div>
            </div>

            <div class="card card-pump">
                <i class="fa-solid fa-droplet"></i>
                <h3>Water Pump</h3>
                <div class="value" id="disp-pump">OFF</div>
            </div>

            <div class="card">
                <i class="fa-solid fa-car-battery"></i>
                <h3>Robot Movement</h3>
                <div class="value" id="disp-motor">Stop</div>
            </div>
        </div>

        <div class="data-table-container">
            <h3>Recent Data Logs</h3>
            <table id="logs-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Status</th>
                        <th>Intensity</th>
                        <th>Pump</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5">Waiting for data...</td></tr>
                </tbody>
            </table>
        </div>
    </section>

    <script>
        // --- CONFIGURATION ---
        const CHANNEL_ID = '3192760';
        const READ_API_KEY = 'U9KV0DCCHXXX90QU'; 
        const API_URL = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?api_key=${READ_API_KEY}&results=1`;

        let fetchInterval = null;

        // --- NAVIGATION LOGIC ---
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Handle Navigation Bar State
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            document.getElementById('nav-public').style.display = isLoggedIn ? 'none' : 'flex'; 
            document.getElementById('nav-private').style.display = isLoggedIn ? 'flex' : 'none'; 

            // Start/Stop Data Fetching based on page
            if (pageId === 'dashboard' && isLoggedIn) {
                fetchData(); // Fetch immediately
                if (!fetchInterval) fetchInterval = setInterval(fetchData, 3000); // Fetch every 3s
            } else {
                if (fetchInterval) clearInterval(fetchInterval);
                fetchInterval = null;
            }
        }

        // --- AUTH LOGIC (SIMULATED) ---
        function handleLogin(e) {
            e.preventDefault();
            localStorage.setItem('isLoggedIn', 'true');
            showPage('dashboard');
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            showPage('landing');
        }

        // --- IOT DATA LOGIC (Functionality is preserved) ---
        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                if (data.feeds && data.feeds.length > 0) {
                    updateDashboard(data.feeds[0]);
                }
            } catch (error) {
                console.error("Error fetching ThingSpeak data:", error);
            }
        }

        function updateDashboard(feed) {
            // Field Mapping: Field1: Fire Status (0/1), Field2: Intensity, Field3: Direction, Field4: Pump (0/1), Field5: Motor (0-4)

            const fireStatus = feed.field1;
            const intensity = feed.field2;
            const direction = feed.field3;
            const pumpStatus = feed.field4;
            const motorState = feed.field5;
            const timestamp = new Date(feed.created_at).toLocaleTimeString();

            // 1. UPDATE FIRE STATUS
            const statusEl = document.getElementById('disp-status');
            const cardFire = document.getElementById('card-fire-status');
            
            if (fireStatus == '1') {
                statusEl.innerText = "FIRE DETECTED!";
                statusEl.style.color = "var(--accent)"; 
                cardFire.classList.add('active-fire'); 
            } else {
                statusEl.innerText = "Safe";
                statusEl.style.color = "var(--success)";
                cardFire.classList.remove('active-fire');
            }

            // 2. UPDATE INTENSITY
            document.getElementById('disp-intensity').innerText = intensity || '0';

            // 3. UPDATE DIRECTION
            document.getElementById('disp-direction').innerText = direction || '--';

            // 4. UPDATE PUMP
            const pumpEl = document.getElementById('disp-pump');
            if (pumpStatus == '1') {
                pumpEl.innerText = "ON";
                pumpEl.style.color = "var(--primary)"; 
            } else {
                pumpEl.innerText = "OFF";
                pumpEl.style.color = "#7F8C8D"; 
            }

            // 5. UPDATE MOTOR STATE (Mapping 0-4)
            const motorEl = document.getElementById('disp-motor');
            let motorText = "Stop";
            switch(motorState) {
                case '0': motorText = "Stop"; break;
                case '1': motorText = "Forward"; break;
                case '2': motorText = "Backward"; break;
                case '3': motorText = "Turning Left"; break;
                case '4': motorText = "Turning Right"; break;
                default: motorText = motorState || "Idle";
            }
            motorEl.innerText = motorText;

            // 6. UPDATE TABLE
            updateTable(timestamp, fireStatus, intensity, pumpStatus, motorText);
        }

        function updateTable(time, status, intensity, pump, motor) {
            const tbody = document.querySelector('#logs-table tbody');
            const statusColor = status == '1' ? 'var(--accent)' : 'var(--success)';
            const pumpText = pump == '1' ? 'ON' : 'OFF';

            const row = `
                <tr>
                    <td>${time}</td>
                    <td style="color: ${statusColor}">
                        ${status == '1' ? 'Detected' : 'Safe'}
                    </td>
                    <td>${intensity}</td>
                    <td>${pumpText}</td>
                    <td>${motor}</td>
                </tr>
            `;
            // Add new row at the top and keep only last 5 rows
            let currentRows = tbody.innerHTML;
            if(currentRows.includes("Waiting")) currentRows = "";
            
            tbody.innerHTML = row + currentRows;
            
            // Clean up: Limit to 5 rows to prevent clutter
            if (tbody.children.length > 5) {
                tbody.removeChild(tbody.lastElementChild);
            }
        }

        // --- INITIALIZATION ---
        if (localStorage.getItem('isLoggedIn') === 'true') {
            showPage('dashboard');
        } else {
            showPage('landing');
        }

    </script>
</body>
</html>